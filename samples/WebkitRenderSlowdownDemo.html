<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>Webkit DOM Element Render Slowdown Demo</title>  
		<style type="text/css">
@-webkit-keyframes updown {
  0%   { height: 100%; }
  50% { height: 0%; }
  100% { height: 100%; }
}
@-webkit-keyframes doubleScaleUpOuter {
  0%   { height: 100%; }
  100% { height: 0%; }
}
@-webkit-keyframes doubleScaleUpInner {
  0%       { height: scaleY(1); }
  50%      { height: scaleY(2); }
  75%      { height: scaleY(4); }
  87.5%    { height: scaleY(8); }
  93.75%   { height: scaleY(16); }
  96.875%  { height: scaleY(32); }
  98.4375% { height: scaleY(64); }
  100%     { height: scaleY(128); }
}
html, body {
	height: 100%;
	width: 100%;
	position: relative;
	margin: 0;
	padding: 0;
}
.frame {
	position: absolute;
	top:0;
	left:0;
	bottom: 0;
	width: 1000px;
	height: 1080px;
	overflow: hidden;
	background-color: #6289A5;
}
.outer {
	position: relative;
	left: 10px;
	top: 10px;
	width: 980px;
	height: 1060px;
	overflow: hidden;
}
.inner {
	position: absolute;
	width: 980px;
	height: 1060px;
	background-image: url(http://resourcefork.com/img/grit-light.png);
	background-color: orange;
	overflow: hidden;
}

#inner::after {
	content: "";
	display: block;
}
.controls {
	position: absolute;
	top: 50px;
	right: 50px;
	width: 25ex;
	border-radius: 1em;
	background-color: #F2F3F2;
	padding: 20px;
}
.controls h4 {
	margin: 0 0 0.8em 0;
	font-size: 110%;
	font-family: sans-serif;
	font-variant: small-caps;
}
.controls input {
	width: 100%;
	background-color: #E5E5E5;
	background-image: -webkit-linear-gradient(top, rgba(255, 255, 255, 0.5) 0%,rgba(255, 255, 255, 0.3) 50%,rgba(0, 0, 0, 0) 50%,rgba(0, 0, 0, 0.1) 100%);
	border-radius: 1em;
	border: 1px solid #83A907;
	color: #000;
	margin: 4px 0 4px;
	box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
}
.controls input:hover {
	background-color: #CADE89;
}
.controls input:active {
	background-color: #83A907;
	margin: 5px 0 3px;
	box-shadow: 0 -1px 1px rgba(0, 0, 0, 0.3);
}
.controls input:focus {
	outline-style: none;
}
.controls .active {
	background-color: #4D740D;
	color: #E5E5E5;
}
.controls .active:hover {
	background-color: #56810E;
}
.hwaccel {
	-webkit-transform: translateZ(0px);
}


.updown {
	-webkit-animation: updown 2s infinite;
}
.doubleScaleUpInner {
	-webkit-animation: updown 2s infinite;
}


.clip-trans {
	-webkit-transition: clip 1s ease-in-out;
	clip: rect(0px 980px 1060px 0px);
}
.clip-trans.end {
	clip: rect(0px 980px 0px 0px);
}

.height-trans {
	-webkit-transition: height 1s ease-in-out;
	height: 1060px;
}
.height-trans.end {
	height: 0px;
}

.mask-trans {
	-webkit-transition: -webkit-mask-position 1s ease-in-out;
	-webkit-mask-position: 0 0%;
	-webkit-mask-size: 100% 200%;
	-webkit-mask-image: -webkit-gradient(linear,center top, center bottom, color-stop(0.00, rgba(0,0,0,1)), color-stop(0.5, rgba(0,0,0,1)), color-stop(0.5, rgba(0,0,0,0)), color-stop(1.00, rgba(0,0,0,0)));
}
.mask-trans.end {
	-webkit-mask-position-y: 100%;
}

.matrix-trans {
	-webkit-transition: -webkit-transform 1s ease-in-out;
	-webkit-transform-origin-y: 0px;
	-webkit-transform: matrix(1, 0, 0, 1, 0, 0),
}
.matrix-trans.end {
	-webkit-transform: matrix(1, 0, 0, 1, 0, -1060);
}

.move-trans {
	-webkit-transition: top 1s ease-in-out;
	top: 10px;
}
.move-trans.end {
	top: -1060px;
}

.opacity-trans {
	-webkit-transition: opacity 1s ease-in-out;
	opacity: 1;
}
.opacity-trans.end {
	opacity: 0;
}

.scale-trans {
	-webkit-transition: -webkit-transform 1s ease-in-out;
	-webkit-transform: scaleY(1);
	-webkit-transform-origin-y: 0px;
}
.scale-trans.end {
	-webkit-transform: scaleY(0);
}

.doublescale-trans,
.doublescale-trans #inner {
	-webkit-transition: -webkit-transform 4s;
	-webkit-transform-origin: 50% 0px;
	-webkit-transform: scaleY(1);
}
.doublescale-trans {
	-webkit-transition-timing-function: linear;
	-webkit-transform-style: preserve-3d;
	-webkit-perspective: 500px;
}
.doublescale-trans #inner {
	-webkit-transition-timing-function: cubic-bezier(0.02, 1, 0, 1);
}
.doublescale-trans.end {
	-webkit-transform: scaleY(0);
}
.doublescale-trans.end #inner {
	-webkit-transition-timing-function: cubic-bezier(1, 0.02, 1, 0);
	-webkit-transform: scaleY(64);
}

</style>
		<script type="text/javascript">//<![CDATA[

var funOnTransitionEnd = function() {};

// Set up some utility methods
Element.prototype.setClassAttribute = function(inClass) {
	this.className = inClass;
};
Element.prototype.getClassAttribute = function() {
	return this.className || "";
};
Element.prototype.hasClass = function(inClass) {
	return inClass && ((" " + this.getClassAttribute() + " ").indexOf(" " + inClass + " ") >= 0);
};
Element.prototype.addClass = function(inClass) {
	if (inClass && !this.hasClass(inClass)) {
		var c = this.getClassAttribute();
		this.setClassAttribute(c + (c ? " " : "") + inClass);
	}
};
Element.prototype.removeClass = function(inClass) {
	if (inClass && this.hasClass(inClass)) {
		var c = this.getClassAttribute();
		c = (" " + c + " ").replace(" " + inClass + " ", " ").slice(1, -1);
		this.setClassAttribute(c);
	}
};
Element.prototype.addRemoveClass = function(inClass, inTrueToAdd) {
	this[inTrueToAdd ? "addClass" : "removeClass"](inClass);
};

function setActive(button) {
	button.addClass("active");
}
function setContentAmount(intAmount) {
	var c = document.getElementById("inner"),
		s = "";
	document.getElementById("content-amount").innerHTML = "Children: " + intAmount;
	var arrMethodButtons = document.getElementsByClassName("amount-button");
	for (var i = 0; i < arrMethodButtons.length; i++) {
		arrMethodButtons[i].removeClass("active");
	};
	for (var i=0; i<intAmount; i++) {
	    s += "<div style='display: inline-block; background: white; width: 100px; margin: 10px;'><div>Line 1</div><div>Line 2</div><div>Line 3</div><div>Line 4<div>Line 4.1</div><div>Line 4.2</div></div></div>"
	}
	c.innerHTML = s;
}

function setMethod(strMethod) {
	var c = document.getElementById("inner"),
		w = document.getElementById("outer"),
		catchupDelay = 5;

	// Remove any listeners we set earlier
	c.removeEventListener("transitionend", funOnTransitionEnd, false);
	w.removeEventListener("transitionend", funOnTransitionEnd, false);

	var objTransitions = {
			clip: {actor: c},
			opacity: {actor: w},
			move: {actor: w},
			scale: {actor: w},
			doublescale: {actor: w},
			mask: {actor: c},
			matrix: {actor: w},
			height: {actor: w}
		};

	// Reset everything
	c.removeClass("end");
	w.removeClass("end");

	for (var trans in objTransitions) {
		c.removeClass(trans + "-trans");
		w.removeClass(trans + "-trans");
	}
	var arrMethodButtons = document.getElementsByClassName("method-button");
	for (var i = 0; i < arrMethodButtons.length; i++) {
		arrMethodButtons[i].removeClass("active");
	};


	var actor = objTransitions[strMethod] && objTransitions[strMethod].actor,
		actorClass = strMethod + "-trans";

	document.getElementById("active-method").innerHTML = "Method: " + strMethod;
	if (actor) {
		actor.addClass(actorClass);
		funOnTransitionEnd = function(e) {
			if (e.srcElement === actor) {
				// console.log(actorClass, ":", actor.hasClass("end"));
				actor.addRemoveClass("end", !(actor.hasClass("end")));
			}
		};
		actor.addEventListener("transitionend", funOnTransitionEnd, false);
		window.setTimeout(function() { actor.addClass("end"); }, catchupDelay);
	}
}

window.onload=function(){
	setContentAmount(10);
	setMethod("doublescale");
	setActive(document.getElementById("initialAmount"));
	setActive(document.getElementById("initialMethod"));
}

//]]>
</script>
	</head>

	<body>
		<div class="frame">
			<div id="outer" class="outer hwaccel">
				<div id="inner" class="inner hwaccel"></div>
			</div>
		</div>

		<div class="controls">
			<h4 id="active-method"></h4>
			<h4 id="content-amount"></h4>
			<input type="button" class="amount-button" onclick="setContentAmount(2);    setActive(this);" value="Set 2 Elements" /><br>
			<input type="button" class="amount-button" onclick="setContentAmount(10);   setActive(this);" value="Set 10 Elements" id="initialAmount" /><br>
			<input type="button" class="amount-button" onclick="setContentAmount(20);   setActive(this);" value="Set 20 Elements" /><br>
			<input type="button" class="amount-button" onclick="setContentAmount(200);  setActive(this);" value="Set 200 Elements" /><br>
			<input type="button" class="amount-button" onclick="setContentAmount(500);  setActive(this);" value="Set 500 Elements" /><br>
			<input type="button" class="amount-button" onclick="setContentAmount(1000); setActive(this);" value="Set 1000 Elements" /><br>
			<input type="button" class="amount-button" onclick="setContentAmount(1500); setActive(this);" value="Set 1500 Elements" /><br>
			<input type="button" class="amount-button" onclick="setContentAmount(2000); setActive(this);" value="Set 2000 Elements" /><br><br>
			<input type="button" class="method-button" onclick="setMethod('clip');        setActive(this);" value="Set Method Clip" /><br>
			<input type="button" class="method-button" onclick="setMethod('opacity');     setActive(this);" value="Set Method Opacity" /><br>
			<input type="button" class="method-button" onclick="setMethod('move');        setActive(this);" value="Set Method Move" /><br>
			<input type="button" class="method-button" onclick="setMethod('scale');       setActive(this);" value="Set Method Scale" /><br>
			<input type="button" class="method-button" onclick="setMethod('doublescale'); setActive(this);" value="Set Method Double Scale" id="initialMethod" /><br>
			<input type="button" class="method-button" onclick="setMethod('matrix');      setActive(this);" value="Set Method Matrix" /><br>
			<input type="button" class="method-button" onclick="setMethod('mask');        setActive(this);" value="Set Method Mask" /><br>
			<input type="button" class="method-button" onclick="setMethod('height');      setActive(this);" value="Set Method Height" /><br><br>
			<input type="button" class="method-button" onclick="setMethod('none');        setActive(this);" value="Remove Transition" /><br><br>
			<input type="button" onclick="window.location.reload()" value="Reload the page" />
		</div>
	</body>
</html>
